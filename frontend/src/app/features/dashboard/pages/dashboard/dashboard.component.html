<div class="advanced-dashboard">
    <!-- Header com controles -->
    <div class="dashboard-header">
        <div class="header-title">
            <h1>Salt Management Dashboard</h1>
            <p>Monitoramento completo da infraestrutura SaltStack</p>
        </div>

        <div class="header-controls">
            <select class="minion-selector" [(ngModel)]="selectedMinion" (change)="onMinionSelect(selectedMinion)">
                <option value="*">Todos os Minions</option>
                <!-- Opções dinâmicas serão adicionadas via código -->
            </select>

            <button class="btn btn-primary" (click)="refreshAllData()" [disabled]="loading">
                <i class="fas fa-sync-alt" [class.fa-spin]="loading"></i>
                Atualizar
            </button>

            <button class="btn btn-secondary" (click)="pingAllMinions()">
                <i class="fas fa-wifi"></i>
                Ping Geral
            </button>
        </div>
    </div>

    <!-- Alert de erro -->
    <div class="alert alert-danger" *ngIf="error">
        <i class="fas fa-exclamation-triangle"></i>
        {{ error }}
        <button class="btn-close" (click)="clearError()">×</button>
    </div>

    <!-- Notificações -->
    <app-notification 
        [notification]="notification" 
        (close)="onNotificationClose()">
    </app-notification>

    <!-- Conteúdo principal -->
    <div class="dashboard-content" *ngIf="adminOverview$ | async as overview">

        <!-- Status dos Minions -->
        <app-minion-status-grid [minionsStatus]="overview.minionsStatus">
        </app-minion-status-grid>

        <!-- Minions Pendentes para Aprovação -->
        <app-pending-minions 
            [autoRefresh]="true"
            (operationComplete)="onMinionOperationComplete($event)">
        </app-pending-minions>

        <!-- Métricas de Performance -->
        <app-performance-metrics [cpuData]="overview.systemSummary.cpu" [memoryData]="overview.systemSummary.memory"
            [diskData]="overview.systemSummary.disk">
        </app-performance-metrics>

        <!-- Jobs Recentes -->
        <app-recent-jobs [jobs]="overview.recentJobs" [maxItems]="10">
        </app-recent-jobs>

        <!-- Gerenciamento de Versões VRPdv -->
        <app-version-management 
            [selectedMinions]="selectedMinion"
            (operationComplete)="onVersionOperationComplete($event)">
        </app-version-management>

    </div>

    <!-- Loading State -->
    <div class="loading-overlay" *ngIf="loading">
        <div class="loading-content">
            <div class="spinner"></div>
            <p>Carregando dados do SaltStack...</p>
            <small>A API Salt pode demorar alguns segundos para responder</small>
        </div>
    </div>

    <!-- Estado inicial quando não há dados -->
    <div class="initial-state" *ngIf="!loading && !(adminOverview$ | async) && !error">
        <div class="initial-content">
            <i class="fas fa-server"></i>
            <h3>Carregando Dashboard</h3>
            <p>Aguarde enquanto carregamos os dados do SaltStack...</p>
        </div>
    </div>

    <!-- Notificações -->
    <app-notification 
        [notification]="notification"
        (close)="onNotificationClose()">
    </app-notification>
</div>