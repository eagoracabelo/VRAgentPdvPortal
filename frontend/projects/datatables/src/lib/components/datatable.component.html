<div role="table" visibilityObserver (visible)="recalculate()">
  @if (showToolsBar) {
    <datatable-tools
      [rows]="rows"
      [columns]="_internalColumns"
      [activeMoveColumn]="activeMoveColumn"
      [storageKeyMoveColumn]="storageKeyMoveColumn"
      [storageKeyColumnPrintingPreference]="storageKeyColumnPrintingPreference"
      (isEditColumn)="editColumn($event)"
      (pageSizeChange)="pageSizeLimit($event)"
      [storageKeyPageSize]="storageKeyPageSize"
      [pageSizeOptions]="pageSizeOptions"
      [selectedPageSize]="selectedPageSize"
      [selectedCount]="selected.length"
      [fireEventButtons]="fireEventButtons"
      [fixedFireEventButtons]="fixedFireEventButtons"
      [activeExportFile]="activeExportFile"
      (reloadData)="onReloadData()"
      (exportAll)="onExportAll($event)"
      [disableExportAll]="disableExportAll"
      (resetSelected)="onResetSelected()"
      [showMoveButton]="showMoveButton"
      [fileTitle]="fileTitle"
      [selectionType]="selectionType"
      [onlyLandscapeView]="onlyLandscapeView"
      [preSelectedColumns]="preSelectedColumns"
      [selectedPrintPageType]="selectedPrintPageType"
      [eventTrackingIdentifier]="eventTrackingIdentifier()"
      [groupedRows]="groupedRows"
    ></datatable-tools>
  }

  @if (headerHeight) {
    <datatable-header
      role="rowgroup"
      [sorts]="sorts"
      [scrollbarH]="scrollbarH"
      [innerWidth]="_innerWidth"
      [offsetX]="_offsetX | async"
      [dealsWithGroup]="groupedRows !== undefined"
      [columns]="_internalColumns"
      [headerHeight]="headerHeight"
      [reorderable]="reorderable"
      [targetMarkerTemplate]="targetMarkerTemplate"
      [sortAscendingIcon]="sortHeaderIcons.sortAscending"
      [sortDescendingIcon]="sortHeaderIcons.sortDescending"
      [sortUnsetIcon]="sortHeaderIcons.sortUnsetIcon"
      [allRowsSelected]="allRowsSelected"
      [partialRowsSelected]="partialRowsSelected"
      [selectionType]="selectionType"
      (sort)="onColumnSort($event)"
      (resize)="onColumnResize($event)"
      (reorder)="onColumnReorder($event)"
      (select)="onHeaderSelect($event)"
      (columnContextmenu)="onColumnContextmenu($event)"
      [isEditColumn]="isEditColumn"
      [checkAllItems]="checkAllItems"
    >
    </datatable-header>
  }

  <datatable-body
    role="rowgroup"
    class="scroll"
    [groupRowsBy]="groupRowsBy"
    [groupedRows]="groupedRows"
    [rows]="_internalRows"
    [groupExpansionDefault]="groupExpansionDefault"
    [scrollbarV]="scrollbarV"
    [scrollbarH]="scrollbarH"
    [virtualization]="virtualization"
    [loadingIndicator]="loadingIndicator"
    [externalPaging]="externalPaging"
    [rowHeight]="rowHeight"
    [rowCount]="rowCount"
    [offset]="offset"
    [trackByProp]="trackByProp"
    [columns]="_internalColumns"
    [pageSize]="pageSize"
    [offsetX]="_offsetX | async"
    [rowDetail]="rowDetail"
    [rowAdd]="rowAdd"
    [groupHeader]="groupHeader"
    [selected]="selected"
    [innerWidth]="_innerWidth"
    [bodyHeight]="bodyHeight"
    [selectionType]="selectionType"
    [emptyMessage]="messages.emptyMessage"
    [rowIdentity]="rowIdentity"
    [rowClass]="rowClass"
    [selectCheck]="selectCheck"
    [displayCheck]="displayCheck"
    [summaryRow]="summaryRow"
    [summaryHeight]="summaryHeight"
    [summaryPosition]="summaryPosition"
    (page)="onBodyPage($event)"
    (activate)="activate.emit($event)"
    (rowContextmenu)="onRowContextmenu($event)"
    (select)="onBodySelect($event)"
    (scroll)="onBodyScroll($event)"
    (treeAction)="onTreeAction($event)"
    [isEditColumn]="isEditColumn"
    [clickableRows]="clickableRows"
    [rowClickActiveSelected]="rowClickActiveSelected"
    [errorRows]="errorRows"
    [preventDefaultClickEnable]="preventDefaultClickEnable"
    [summaryCurrency]="summaryCurrency"
    [zindexRowOverNextRow]="zindexRowOverNextRow"
  >
  </datatable-body>

  @if (footerHeight) {
    <datatable-footer
      [sorts]="sorts"
      [rowCount]="rowCount"
      [pageSize]="pageSize"
      [offset]="offset"
      [filter]="filter"
      [footerHeight]="footerHeight"
      [footerTemplate]="footer"
      [ofMessage]="!!selectionType && messages.ofMessage"
      [pagerLeftArrowIcon]="cssClasses.pagerLeftArrow"
      [pagerRightArrowIcon]="cssClasses.pagerRightArrow"
      [pagerPreviousIcon]="cssClasses.pagerPrevious"
      [selectedCount]="selected.length"
      [itemsMessage]="messages.itemsMessage"
      [itemsPerPageMessage]="messages.itemsPerPageMessage"
      [pagerNextIcon]="cssClasses.pagerNext"
      (page)="onFooterPage($event)"
      [pageSizeOptions]="pageSizeOptions"
      [storageKeyPageSize]="storageKeyPageSize"
      [selectedPageSize]="selectedPageSize"
      (pageSizeChange)="pageSizeLimit($event)"
    >
    </datatable-footer>
  }
</div>
